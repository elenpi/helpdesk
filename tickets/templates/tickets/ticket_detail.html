{% extends "base.html" %}

{% block title %}Ticket{% endblock %}

{% block content%}

<h1>{{ticket.title}}</h1>

<section id= "details">
    <p>Reporter: {{ticket.reporter}}</p>
    <p>Created at: {{ticket.time_created}}</p>
    <p>Category: {{ ticket.category }}</p>
    <p>Status: {{ ticket.status }}</p>
</section>

<section id="description">
    <p>{{ ticket.description }}</p>
</section>


<a href="{% url 'ticket-detail-edit' pk=ticket.id %}">Edit</a>
<a href="#" data-id="{{ ticket.pk }}" class="delete-btn">Delete</a>

{% if ticket.status == 'closed' %}
    <form method="post" action="">
        {% csrf_token %}
        <div class="form-group">
            <label for="{{ rating_form.rating.id_for_label }}">Rating:</label>
            {{ rating_form.rating }}
        </div>
        <button type="submit">Submit Rating</button>
    </form>
{% endif %}



{% endblock %} 

{% block javascript %}
<script>
    $(document).ready(function () {
        $('.delete-btn').click(function (e) {
            e.preventDefault();

            var result = confirm('Are you sure you want to delete this ticket?');

            if (result) {
                var ticketId = $(this).data('id');
                $.ajax({
                    url: '{% url "ticket-delete" pk=0 %}'.replace('0', ticketId),
                    data: { 'csrfmiddlewaretoken': '{{ csrf_token }}' },
                    type: 'POST',
                    success: function(response) {
                        if (response == 'Success') {
                            window.location.href = '{% url "tickets-page" %}';
                        } else {
                            alert('There was an error deleting the ticket. Please try again.');
                        }
                    }
                });
            }
        });
    });
</script>
{% endblock %}
